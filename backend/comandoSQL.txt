-- Crear la base de datos
CREATE DATABASE IF NOT EXISTS muebleria;
USE muebleria;

-- Tabla de Muebles
CREATE TABLE mueble (
    id_mueble BIGINT AUTO_INCREMENT PRIMARY KEY,
    nombre_mueble VARCHAR(100) NOT NULL,
    tipo VARCHAR(50) NOT NULL,
    precio_base DECIMAL(10, 2) NOT NULL,
    stock INT NOT NULL DEFAULT 0,
    estado VARCHAR(20) NOT NULL DEFAULT 'ACTIVO',
    tamanio VARCHAR(20) NOT NULL,
    material VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabla de Variantes
CREATE TABLE variante (
    id_variante BIGINT AUTO_INCREMENT PRIMARY KEY,
    nombre_variante VARCHAR(100) NOT NULL,
    descripcion TEXT,
    precio_adicional DECIMAL(10, 2) NOT NULL DEFAULT 0.00,
    tipo_variante VARCHAR(50) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de Cotizaciones
CREATE TABLE cotizacion (
    id_cotizacion BIGINT AUTO_INCREMENT PRIMARY KEY,
    fecha_cotizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total DECIMAL(10, 2) NOT NULL,
    estado VARCHAR(20) NOT NULL DEFAULT 'PENDIENTE',
    confirmada BOOLEAN DEFAULT FALSE,
    fecha_confirmacion TIMESTAMP NULL
);

-- Tabla de Detalle de Cotización (relación entre cotización y muebles)
CREATE TABLE detalle_cotizacion (
    id_detalle BIGINT AUTO_INCREMENT PRIMARY KEY,
    id_cotizacion BIGINT NOT NULL,
    id_mueble BIGINT NOT NULL,
    id_variante BIGINT NULL,
    cantidad INT NOT NULL,
    precio_unitario DECIMAL(10, 2) NOT NULL,
    subtotal DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (id_cotizacion) REFERENCES cotizacion(id_cotizacion) ON DELETE CASCADE,
    FOREIGN KEY (id_mueble) REFERENCES mueble(id_mueble),
    FOREIGN KEY (id_variante) REFERENCES variante(id_variante) ON DELETE SET NULL
);

-- Insertar algunos datos de ejemplo para Muebles
INSERT INTO mueble (nombre_mueble, tipo, precio_base, stock, estado, tamanio, material) VALUES
('Silla Clásica', 'SILLA', 25000.00, 50, 'ACTIVO', 'PEQUENO', 'Madera'),
('Sillón Comfort', 'SILLON', 120000.00, 20, 'ACTIVO', 'GRANDE', 'Tela'),
('Mesa Comedor', 'MESA', 180000.00, 15, 'ACTIVO', 'GRANDE', 'Madera'),
('Estante Modular', 'ESTANTE', 95000.00, 30, 'ACTIVO', 'MEDIANO', 'MDF'),
('Cajón Triple', 'CAJON', 65000.00, 25, 'ACTIVO', 'MEDIANO', 'Pino');

-- Insertar algunos datos de ejemplo para Variantes
INSERT INTO variante (nombre_variante, descripcion, precio_adicional, tipo_variante) VALUES
('Normal', 'Sin variaciones adicionales', 0.00, 'ESTANDAR'),
('Barniz Premium', 'Acabado con barniz de alta calidad', 15000.00, 'ACABADO'),
('Cojines de Seda', 'Cojines premium de seda natural', 25000.00, 'TAPIZADO'),
('Ruedas Giratorias', 'Ruedas de alta resistencia', 8000.00, 'ACCESORIOS'),
('Vidrio Templado', 'Cubierta de vidrio templado', 30000.00, 'ACABADO'),
('Herrajes Cromados', 'Herrajes de acero cromado', 12000.00, 'ACCESORIOS');